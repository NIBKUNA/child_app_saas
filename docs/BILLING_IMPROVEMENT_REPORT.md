# ğŸ“‹ ìˆ˜ë‚© ê´€ë¦¬ ê¸°ëŠ¥ ìˆ˜ì • ë³´ê³ ì„œ
## Zarada ERP Ã— ì¼€ì–´í”Œ ê¸°ëŠ¥ ì°¸ê³  ê°œì„ ì•ˆ
### ì‘ì„±ì¼: 2026-02-11

---

## 1. í˜„ì¬ ì‹œìŠ¤í…œ ë¶„ì„

### 1.1 í˜„ì¬ ìˆ˜ë‚© íë¦„ (AS-IS)

```
[ì¼ì • ë“±ë¡] â†’ [ìˆ˜ì—… ì§„í–‰] â†’ [ìƒíƒœ ë³€ê²½: ì˜ˆì •â†’ì™„ë£Œ/ì·¨ì†Œ]
                                    â†“
                            [ìˆ˜ë‚© ê´€ë¦¬ í˜ì´ì§€]
                                    â†“
                    [ì™„ë£Œëœ ìˆ˜ì—…ë£Œ í•©ì‚°] â†’ [ì¹´ë“œ/í˜„ê¸ˆ/í¬ë ˆë”§ìœ¼ë¡œ ê²°ì œ]
                                    â†“
                            [payments í…Œì´ë¸”ì— ì €ì¥]
```

### 1.2 í˜„ì¬ ì§€ì› ìƒíƒœê°’

| ìƒíƒœ | ScheduleModal (ì¼ì •) | Billing (ìˆ˜ë‚©) | ì„¤ëª… |
|------|:---:|:---:|------|
| `scheduled` (ì˜ˆì •) | âœ… | âœ… | ìˆ˜ì—… ì˜ˆì • |
| `completed` (ì™„ë£Œ) | âœ… | âœ… | ìˆ˜ì—… ì™„ë£Œ â†’ ìˆ˜ë‚© ëŒ€ìƒ |
| `cancelled` (ì·¨ì†Œ) | âœ… | âœ… | ìˆ˜ì—… ì·¨ì†Œ â†’ ê¸ˆì•¡ 0ì› |
| `carried_over` (ì´ì›”) | âœ… | âŒ **ëˆ„ë½** | ì¼ì •ì—ì„œëŠ” ì´ì›” ê°€ëŠ¥í•˜ë‚˜ ìˆ˜ë‚©ì—ì„œ ì²˜ë¦¬ ì•ˆë¨ |

### 1.3 ë°œê²¬ëœ í•µì‹¬ ë¬¸ì œì 

| # | ë¬¸ì œ | ì‹¬ê°ë„ | ì„¤ëª… |
|---|------|:---:|------|
| 1 | **ì´ì›” ìƒíƒœ ë¯¸ì²˜ë¦¬** | ğŸ”´ ë†’ìŒ | `carried_over` ìƒíƒœê°€ Billing.tsxì˜ ScheduleStatus íƒ€ì…ì— ì—†ìŒ. ì´ì›”ëœ ì„¸ì…˜ì´ ìˆ˜ë‚©ì—ì„œ ê¸ˆì•¡ ì²˜ë¦¬ê°€ ì•ˆë¨ |
| 2 | **ì´ì›” ê¸ˆì•¡ â†’ í¬ë ˆë”§ ë¯¸ì—°ë™** | ğŸ”´ ë†’ìŒ | ì´ì›” ì‹œ í•´ë‹¹ ì„¸ì…˜ì˜ ê¸ˆì•¡ì´ ë‹¤ìŒ ë‹¬ í¬ë ˆë”§ìœ¼ë¡œ ìë™ ì „í™˜ë˜ì§€ ì•ŠìŒ |
| 3 | **center_id ë¯¸ì‚½ì…** | ğŸŸ¡ ì¤‘ê°„ | payments í…Œì´ë¸”ì— center_idë¥¼ ë„£ì§€ ì•Šì•„ ë©€í‹°ì„¼í„° í™˜ê²½ì—ì„œ ë°ì´í„° ê²©ë¦¬ ë¬¸ì œ |
| 4 | **í™˜ë¶ˆ ê¸°ëŠ¥ ë¶€ì¬** | ğŸŸ¡ ì¤‘ê°„ | ìˆ˜ë‚© ì™„ë£Œ í›„ í™˜ë¶ˆ ì²˜ë¦¬ ê¸°ëŠ¥ì´ ì—†ìŒ (ë³´ì •ë§Œ ì¡´ì¬) |
| 5 | **ìˆ˜ë‚© ì´ë ¥ ì¡°íšŒ ë¶ˆê°€** | ğŸŸ¡ ì¤‘ê°„ | ê³¼ê±° ìˆ˜ë‚© ê¸°ë¡ì„ ìƒì„¸íˆ ë³¼ ìˆ˜ ì—†ìŒ |

---

## 2. ì¼€ì–´í”Œ ì‹œìŠ¤í…œ ê¸°ëŠ¥ ì°¸ê³  ë¶„ì„

### 2.1 ì¼€ì–´í”Œ ìˆ˜ë‚© í•µì‹¬ ê¸°ëŠ¥

ì¼€ì–´í”Œì„¼í„°ì˜ ìˆ˜ë‚© ê´€ë¦¬ ì‹œìŠ¤í…œì€ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

1. **ìˆ˜ë‚© ì²˜ë¦¬**: ìˆ˜ì—…ë³„, ì´ìš©ìë³„, í”„ë¡œê·¸ë¨ë³„ ìˆ˜ë‚© í˜„í™© ê´€ë¦¬
2. **ì´ì›” ì²˜ë¦¬**: ë¯¸ì§„í–‰ ë˜ëŠ” ì·¨ì†Œëœ íšŒê¸°ì˜ ê¸ˆì•¡ì„ ë‹¤ìŒ ë‹¬ë¡œ ì´ì›”
3. **í™˜ë¶ˆ ì²˜ë¦¬**: ìˆ˜ë‚© ì™„ë£Œ í›„ í™˜ë¶ˆ(ì „ì•¡/ë¶€ë¶„) ê°€ëŠ¥
4. **í• ì¸ ê´€ë¦¬**: í• ì¸ ê¸ˆì•¡ ì ìš© ë° ê´€ë¦¬
5. **ë°”ìš°ì²˜ ê´€ë¦¬**: ë°”ìš°ì²˜ ì‚¬ìš© ë‚´ì—­ ë° ì”ì•¡ ê´€ë¦¬
6. **ìë¶€ë‹´ê¸ˆ ìë™ ê³„ì‚°**: ë°”ìš°ì²˜ + ìë¶€ë‹´ê¸ˆ ìë™ ë¶„ë¦¬ ê³„ì‚°
7. **ìˆ˜ë‚© í†µê³„**: ê¸°ê°„ë³„ ë§¤ì¶œ ë¹„êµ, ë¯¸ìˆ˜ê¸ˆ í˜„í™©

### 2.2 ì¼€ì–´í”Œ ì´ì›” ë¡œì§ (í•µì‹¬)

```
[ì˜ˆì‹œ ì‹œë‚˜ë¦¬ì˜¤]

1ì›”: ì•„ë™ A - ì£¼ 2íšŒ Ã— 4ì£¼ = 8íšŒê¸° ë“±ë¡
    â†’ ìˆ˜ì—…ë£Œ: 8 Ã— 50,000ì› = 400,000ì›
    â†’ ìˆ˜ë‚© ì™„ë£Œ: 400,000ì› ê²°ì œ

1ì›” ë§ˆì§€ë§‰ ì£¼: 1íšŒê¸° ê²°ì„ â†’ "ì´ì›”" ì²˜ë¦¬
    â†’ ì´ì›” ê¸ˆì•¡: 50,000ì›ì´ í¬ë ˆë”§ìœ¼ë¡œ ì „í™˜

2ì›”: ì•„ë™ A - 8íšŒê¸° ë“±ë¡
    â†’ ìˆ˜ì—…ë£Œ: 8 Ã— 50,000ì› = 400,000ì›
    â†’ ì´ì›” í¬ë ˆë”§: 50,000ì› ì‚¬ìš© ê°€ëŠ¥
    â†’ ì‹¤ì œ ê²°ì œ í•„ìš”ì•¡: 350,000ì›
```

**í•µì‹¬ ì›ì¹™:**
- ì´ì›”ëœ íšŒê¸°ì˜ ê¸ˆì•¡ì€ **ì•„ë™ í¬ë ˆë”§(credit)ìœ¼ë¡œ ìë™ ì ë¦½**
- ë‹¤ìŒ ë‹¬ ìˆ˜ë‚© ì‹œ í¬ë ˆë”§ **ìë™ ì°¨ê°** ë˜ëŠ” **ìˆ˜ë™ ì‚¬ìš©** ì„ íƒ ê°€ëŠ¥
- ì´ì›” í¬ë ˆë”§ì€ **í•´ë‹¹ ì•„ë™ì—ê²Œë§Œ** ê·€ì† (íƒ€ ì•„ë™ ì „ìš© ë¶ˆê°€)

---

## 3. ìˆ˜ì • ê³„íš (TO-BE)

### 3.1 ê°œì„ ëœ ìˆ˜ë‚© íë¦„ë„

```
[ì¼ì • ë“±ë¡] â†’ [ìˆ˜ì—… ì§„í–‰] â†’ [ìƒíƒœ ë³€ê²½]
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           â”‚               â”‚
                 [ì™„ë£Œ]      [ì·¨ì†Œ]          [ì´ì›”]
                 ê¸ˆì•¡ í•©ì‚°    ê¸ˆì•¡ 0ì›      ê¸ˆì•¡ â†’ í¬ë ˆë”§ ì ë¦½
                    â”‚                          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
                    â”Œâ”€â”€â”€ [ìˆ˜ë‚© ê´€ë¦¬ í˜ì´ì§€] â”€â”€â”€â”
                    â”‚                          â”‚
                    â”‚  â‘  ìˆ˜ì—…ë£Œ í•©ì‚° (ì™„ë£Œë¶„)    â”‚
                    â”‚  â‘¡ ì´ì›” í¬ë ˆë”§ í‘œì‹œ       â”‚
                    â”‚  â‘¢ ê¸°ìˆ˜ë‚©ì•¡ í‘œì‹œ          â”‚
                    â”‚  â‘£ ë¯¸ìˆ˜ê¸ˆ ê³„ì‚°            â”‚
                    â”‚  â‘¤ ê²°ì œ ì²˜ë¦¬             â”‚
                    â”‚  â‘¥ í™˜ë¶ˆ ì²˜ë¦¬             â”‚
                    â”‚  â‘¦ ìˆ˜ë‚© ì´ë ¥ ì¡°íšŒ        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ìƒíƒœë³„ ì²˜ë¦¬ ë¡œì§ (ìƒì„¸)

#### A. ì˜ˆì • (scheduled)
```
- ìˆ˜ë‚© ëŒ€ìƒ: âŒ (ì•„ì§ ìˆ˜ì—… ì „)
- ê¸ˆì•¡ ê³„ì‚°: 0ì› (ì˜ˆìƒ ê¸ˆì•¡ë§Œ í‘œì‹œ)
- UI: íšŒìƒ‰ ë°°ê²½, "ì˜ˆì •" ë¼ë²¨
```

#### B. ì™„ë£Œ (completed)
```
- ìˆ˜ë‚© ëŒ€ìƒ: âœ…
- ê¸ˆì•¡ ê³„ì‚°: í”„ë¡œê·¸ë¨ ë‹¨ê°€ í•©ì‚°
- UI: ë…¹ìƒ‰ ë°°ê²½, "ì™„ë£Œ" ë¼ë²¨, ì²´í¬ í‘œì‹œ
```

#### C. ì·¨ì†Œ (cancelled)
```
- ìˆ˜ë‚© ëŒ€ìƒ: âŒ
- ê¸ˆì•¡ ê³„ì‚°: 0ì›
- ì´ë¯¸ ìˆ˜ë‚©í•œ ê²½ìš°: í™˜ë¶ˆ ëŒ€ìƒìœ¼ë¡œ í‘œì‹œ
- UI: ë¹¨ê°„ ë°°ê²½, "ì·¨ì†Œ" ë¼ë²¨, ì·¨ì†Œì„ 
```

#### D. ì´ì›” (carried_over) â­ í•µì‹¬ ì‹ ê·œ
```
- ìˆ˜ë‚© ëŒ€ìƒ: âŒ (ì´ë²ˆ ë‹¬ ìˆ˜ë‚©ì—ì„œ ì œì™¸)
- ê¸ˆì•¡ ì²˜ë¦¬: í•´ë‹¹ ì„¸ì…˜ ê¸ˆì•¡ â†’ ì•„ë™ í¬ë ˆë”§(credit)ì— ìë™ ì ë¦½
- ë‹¤ìŒ ë‹¬: í¬ë ˆë”§ìœ¼ë¡œ ìˆ˜ë‚© ì‹œ ì‚¬ìš© ê°€ëŠ¥
- UI: ë³´ë¼ìƒ‰ ë°°ê²½, "ì´ì›”" ë¼ë²¨, í™”ì‚´í‘œ ì•„ì´ì½˜
- ì´ë ¥: "â—‹ì›” â—‹ì¼ ì´ì›” (50,000ì› â†’ í¬ë ˆë”§ ì ë¦½)" ê¸°ë¡
```

### 3.3 ìˆ˜ë‚© ëª¨ë‹¬ ê°œì„ ì•ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í™ê¸¸ë™ ìˆ˜ë‚© ìƒì„¸                    [ë‹«ê¸° âœ•]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚                           â”‚
â”‚  ğŸ“… ì„¸ì…˜ ëª©ë¡    â”‚   ğŸ’° ê²°ì œ ì •ë³´             â”‚
â”‚                 â”‚                           â”‚
â”‚  âœ… 01/03 ì–¸ì–´ì¹˜ë£Œ  50,000 â”‚  ì´ì›” í¬ë ˆë”§     â”‚
â”‚  âœ… 01/07 ì–¸ì–´ì¹˜ë£Œ  50,000 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  âœ… 01/10 ì–¸ì–´ì¹˜ë£Œ  50,000 â”‚  â”‚ 100,000ì› â”‚  â”‚
â”‚  âœ… 01/14 ì–¸ì–´ì¹˜ë£Œ  50,000 â”‚  â”‚ [ì „ì•¡ì‚¬ìš©] â”‚  â”‚
â”‚  âœ… 01/17 ì–¸ì–´ì¹˜ë£Œ  50,000 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  âœ… 01/21 ì–¸ì–´ì¹˜ë£Œ  50,000 â”‚                  â”‚
â”‚  âœ… 01/24 ì–¸ì–´ì¹˜ë£Œ  50,000 â”‚  ì¹´ë“œ: [      ]  â”‚
â”‚  ğŸ”„ 01/28 ì´ì›”      -     â”‚  í˜„ê¸ˆ: [      ]  â”‚
â”‚                 â”‚                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  ì´ 7íšŒ ì™„ë£Œ    â”‚  ìˆ˜ì—…ë£Œ:    350,000ì›       â”‚
â”‚  1íšŒ ì´ì›”       â”‚  - ì´ì›”ë¶„:  -50,000ì›      â”‚
â”‚                 â”‚  - í¬ë ˆë”§: -100,000ì›      â”‚
â”‚                 â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                 â”‚  ìµœì¢… ê²°ì œ: 200,000ì›       â”‚
â”‚                 â”‚                           â”‚
â”‚                 â”‚  [ğŸ’³ ìˆ˜ë‚© ì™„ë£Œ] [ğŸ”§ í™˜ë¶ˆ]   â”‚
â”‚                 â”‚                           â”‚
â”‚  ğŸ“‹ ìˆ˜ë‚© ì´ë ¥   â”‚                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                           â”‚
â”‚  01/05 ì¹´ë“œ     â”‚                           â”‚
â”‚   200,000ì›     â”‚                           â”‚
â”‚  01/15 í˜„ê¸ˆ     â”‚                           â”‚
â”‚   150,000ì›     â”‚                           â”‚
â”‚                 â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 ìˆ˜ì • ëŒ€ìƒ íŒŒì¼ ëª©ë¡

| # | íŒŒì¼ | ìˆ˜ì • ë‚´ìš© | ìš°ì„ ìˆœìœ„ |
|---|------|---------|:---:|
| 1 | `Billing.tsx` | ì „ì²´ ë¦¬íŒ©í„°ë§: ì´ì›” ì§€ì›, í™˜ë¶ˆ, ìˆ˜ë‚© ì´ë ¥, center_id ì‚½ì… | ğŸ”´ 1ìˆœìœ„ |
| 2 | `ScheduleModal.tsx` | ì´ì›” ìƒíƒœ ë³€ê²½ ì‹œ í¬ë ˆë”§ ìë™ ì ë¦½ ë¡œì§ ì¶”ê°€ | ğŸ”´ 1ìˆœìœ„ |
| 3 | `database.types.ts` | í•„ìš”ì‹œ íƒ€ì… ì—…ë°ì´íŠ¸ | ğŸŸ¡ 2ìˆœìœ„ |
| 4 | `schema.sql` | `schedule_status` ENUMì— `carried_over` ì¶”ê°€ í™•ì¸ | ğŸŸ¡ 2ìˆœìœ„ |

---

## 4. ì½”ë“œ ìˆ˜ì • ìƒì„¸ ëª…ì„¸

### 4.1 Billing.tsx ìˆ˜ì • ì‚¬í•­

#### (A) ScheduleStatus íƒ€ì…ì— 'carried_over' ì¶”ê°€
```typescript
// BEFORE
type ScheduleStatus = 'scheduled' | 'completed' | 'canceled' | 'cancelled';

// AFTER
type ScheduleStatus = 'scheduled' | 'completed' | 'canceled' | 'cancelled' | 'carried_over';
```

#### (B) ì´ì›” ì„¸ì…˜ ê¸ˆì•¡ ì²˜ë¦¬ ë¡œì§
```typescript
// stats ê³„ì‚° ì‹œ ì´ì›” ì²˜ë¦¬
const isCarriedOver = item.status === 'carried_over';
const isCanceled = item.status === 'canceled' || item.status === 'cancelled';
const price = (isCanceled || isCarriedOver) ? 0 : (item.programs?.price || 0);

// ì´ì›” ê¸ˆì•¡ ë³„ë„ í•©ì‚° (í¬ë ˆë”§ìœ¼ë¡œ í‘œì‹œ)
if (isCarriedOver) {
    childMap[childId].carriedOverAmount += (item.programs?.price || 0);
}
```

#### (C) ChildBillingData ì¸í„°í˜ì´ìŠ¤ í™•ì¥
```typescript
interface ChildBillingData {
    id: string;
    name: string;
    paid: number;
    credit: number;
    completed: number;
    carriedOverAmount: number;    // â­ ì´ì›” ê¸ˆì•¡ í•©ê³„
    refunded: number;            // â­ í™˜ë¶ˆ ê¸ˆì•¡ í•©ê³„
    sessions: BillingSession[];
    paymentHistory: PaymentRecord[]; // â­ ìˆ˜ë‚© ì´ë ¥
}
```

#### (D) center_id ì‚½ì… (payments)
```typescript
// BEFORE
const paymentData = {
    child_id: childData.id,
    amount: payAmount,
    // ... center_id ì—†ìŒ
};

// AFTER
const paymentData = {
    child_id: childData.id,
    center_id: center.id,  // â­ ì„¼í„° ID í•„ìˆ˜ ì‚½ì…
    amount: payAmount,
    // ...
};
```

#### (E) í™˜ë¶ˆ ì²˜ë¦¬ ê¸°ëŠ¥ ì¶”ê°€
```typescript
const handleRefund = async (paymentId: string, refundAmount: number) => {
    // 1. ì›ë³¸ paymentsì—ì„œ í™˜ë¶ˆ ì²˜ë¦¬ ê¸°ë¡
    await supabase.from('payments').insert({
        child_id: childData.id,
        center_id: center.id,
        amount: -refundAmount,  // ë§ˆì´ë„ˆìŠ¤ ê¸ˆì•¡
        method: 'í™˜ë¶ˆ',
        memo: `í™˜ë¶ˆ ì²˜ë¦¬ (ì›ë³¸: ${paymentId})`,
        payment_month: month,
    });

    // 2. í¬ë ˆë”§ ë³µì› (í•„ìš”ì‹œ)
    // 3. UI ê°±ì‹ 
};
```

### 4.2 ScheduleModal.tsx ìˆ˜ì • ì‚¬í•­

#### ì´ì›” ìƒíƒœ ë³€ê²½ ì‹œ í¬ë ˆë”§ ìë™ ì ë¦½
```typescript
// ìƒíƒœë¥¼ 'carried_over'ë¡œ ë³€ê²½í•  ë•Œ
const handleStatusChange = async (newStatus: string) => {
    if (newStatus === 'carried_over') {
        // 1. í•´ë‹¹ ì„¸ì…˜ì˜ í”„ë¡œê·¸ë¨ ê°€ê²© ì¡°íšŒ
        const sessionPrice = programs.find(p => p.id === formData.program_id)?.price || 0;

        // 2. ì•„ë™ì˜ í¬ë ˆë”§ì— í•´ë‹¹ ê¸ˆì•¡ ì¶”ê°€
        const { data: child } = await supabase
            .from('children')
            .select('credit')
            .eq('id', formData.child_id)
            .single();

        const newCredit = (child?.credit || 0) + sessionPrice;

        await supabase
            .from('children')
            .update({ credit: newCredit })
            .eq('id', formData.child_id);

        // 3. ì¼ì • ìƒíƒœë¥¼ ì´ì›”ë¡œ ë³€ê²½
        await supabase
            .from('schedules')
            .update({ status: 'carried_over' })
            .eq('id', scheduleId);
    }
};
```

**ì£¼ì˜: ì´ì›” â†’ ë‹¤ë¥¸ ìƒíƒœë¡œ ë˜ëŒë¦´ ë•Œ í¬ë ˆë”§ ì°¨ê° í•„ìš”**
```typescript
// ì´ì „ ìƒíƒœê°€ carried_overì˜€ëŠ”ë° ë‹¤ë¥¸ ìƒíƒœë¡œ ë³€ê²½í•  ë•Œ
if (previousStatus === 'carried_over' && newStatus !== 'carried_over') {
    const sessionPrice = programs.find(p => p.id === formData.program_id)?.price || 0;
    const newCredit = Math.max(0, (child?.credit || 0) - sessionPrice);
    await supabase.from('children').update({ credit: newCredit }).eq('id', formData.child_id);
}
```

### 4.3 ìˆ˜ë‚© ëŒ€ì¥ (ë©”ì¸ í…Œì´ë¸”) UI ê°œì„ 

**í˜„ì¬:**
```
| ì•„ë™ ì •ë³´ | ìˆ˜ì—…ë£Œ(ì™„ë£Œ) | ê¸°ìˆ˜ë‚©ì•¡ | ì”ì•¡ | ê´€ë¦¬ |
```

**ê°œì„  í›„:**
```
| ì•„ë™ ì •ë³´ | ìˆ˜ì—…ë£Œ(ì™„ë£Œ) | ì´ì›” í¬ë ˆë”§ | ê¸°ìˆ˜ë‚©ì•¡ | ë¯¸ìˆ˜ê¸ˆ | ìƒíƒœ | ê´€ë¦¬ |
```

- **ì´ì›” í¬ë ˆë”§**: ì´ì›”ë¡œ ì¸í•œ ì•„ë™ í¬ë ˆë”§ ì”ì•¡ í‘œì‹œ
- **ë¯¸ìˆ˜ê¸ˆ**: ìˆ˜ì—…ë£Œ - ê¸°ìˆ˜ë‚©ì•¡ (ë§ˆì´ë„ˆìŠ¤ë©´ ê³¼ë‚© í‘œì‹œ)
- **ìƒíƒœ**: ì™„ë‚© ğŸŸ¢ / ë¯¸ìˆ˜ ğŸ”´ / ê³¼ë‚© ğŸ”µ ë±ƒì§€ í‘œì‹œ

---

## 5. ì‘ë™ ì‹œë‚˜ë¦¬ì˜¤ (ì™„ì„± í›„)

### ì‹œë‚˜ë¦¬ì˜¤ 1: ê¸°ë³¸ ìˆ˜ë‚©

```
1. ì•„ë™ A, 1ì›” 8íšŒê¸° ìˆ˜ì—… ë“±ë¡ (5ë§Œì›/íšŒ)
2. 8íšŒ ëª¨ë‘ ì™„ë£Œ
3. ìˆ˜ë‚© ê´€ë¦¬ì—ì„œ: ìˆ˜ì—…ë£Œ 400,000ì› í‘œì‹œ
4. ì¹´ë“œ 400,000ì› ê²°ì œ â†’ "ìˆ˜ë‚© ì™„ë£Œ"
5. ì”ì•¡: 0ì› (ì™„ë‚© ìƒíƒœ ğŸŸ¢)
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì´ì›” í¬í•¨ ìˆ˜ë‚©

```
1. ì•„ë™ B, 1ì›” 8íšŒê¸° ë“±ë¡ (5ë§Œì›/íšŒ)
2. 7íšŒ ì™„ë£Œ, 1íšŒ ì´ì›” ì²˜ë¦¬
   â†’ ì´ì›” ì‹œ: ì•„ë™ Bì˜ í¬ë ˆë”§ì— 50,000ì› ìë™ ì ë¦½
3. ìˆ˜ë‚© ê´€ë¦¬ì—ì„œ:
   - ìˆ˜ì—…ë£Œ(ì™„ë£Œ): 350,000ì› (7íšŒë¶„)
   - ì´ì›” í¬ë ˆë”§: 50,000ì› í‘œì‹œ
4. ì¹´ë“œ 350,000ì› ê²°ì œ â†’ "ìˆ˜ë‚© ì™„ë£Œ"

--- ë‹¤ìŒ ë‹¬ (2ì›”) ---

5. ì•„ë™ B, 2ì›” 8íšŒê¸° ë“±ë¡ (5ë§Œì›/íšŒ)
6. ìˆ˜ë‚© ê´€ë¦¬ì—ì„œ:
   - ìˆ˜ì—…ë£Œ: 400,000ì›
   - ì´ì›” í¬ë ˆë”§: 50,000ì› (ì‚¬ìš© ê°€ëŠ¥)
   - [ì „ì•¡ ì‚¬ìš©] í´ë¦­ â†’ í¬ë ˆë”§ 50,000ì› ì°¨ê°
7. ì‹¤ì œ ê²°ì œ: 350,000ì›
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: í™˜ë¶ˆ ì²˜ë¦¬

```
1. ì•„ë™ C, 1ì›” ìˆ˜ë‚© ì™„ë£Œ (400,000ì›)
2. ì´í›„ 2íšŒ ì·¨ì†Œ ë°œìƒ
3. í™˜ë¶ˆ ì²˜ë¦¬:
   - í™˜ë¶ˆ ê¸ˆì•¡: 100,000ì›
   - paymentsì— -100,000ì› ê¸°ë¡
4. ìˆ˜ë‚© ì´ë ¥ì— "í™˜ë¶ˆ 100,000ì›" í‘œì‹œ
```

### ì‹œë‚˜ë¦¬ì˜¤ 4: ê³¼ë‚© â†’ ì´ì›” ë³€í™˜

```
1. ì•„ë™ D, 1ì›” ë¯¸ë¦¬ 400,000ì› ìˆ˜ë‚©
2. ì‹¤ì œ ì™„ë£Œ 6íšŒ (300,000ì›)
3. ê³¼ë‚© ìƒíƒœ: +100,000ì›
4. ë³´ì • ë²„íŠ¼ìœ¼ë¡œ 100,000ì› â†’ í¬ë ˆë”§ìœ¼ë¡œ ì „í™˜
5. 2ì›”ì— í¬ë ˆë”§ 100,000ì› ì‚¬ìš© ê°€ëŠ¥
```

---

## 6. ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸ ì‚¬í•­

### 6.1 schedule_status ENUM í™•ì¸ SQL
```sql
-- carried_overê°€ ENUMì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
SELECT enum_range(NULL::schedule_status);

-- ì—†ìœ¼ë©´ ì¶”ê°€
ALTER TYPE schedule_status ADD VALUE IF NOT EXISTS 'carried_over';
```

### 6.2 payments í…Œì´ë¸” center_id í™•ì¸
```sql
-- center_id ì»¬ëŸ¼ ì¡´ì¬ í™•ì¸
SELECT column_name, data_type
FROM information_schema.columns
WHERE table_name = 'payments';
```

---

## 7. êµ¬í˜„ ìš°ì„ ìˆœìœ„ ë¡œë“œë§µ

### Phase 1: í•µì‹¬ ë²„ê·¸ ìˆ˜ì • (ì¦‰ì‹œ) âœ… ì™„ë£Œ (2026-02-11)
- [x] Billing.tsx ScheduleStatusì— `carried_over` ì¶”ê°€
- [x] payments INSERT ì‹œ `center_id` í¬í•¨
- [x] ì´ì›” ì„¸ì…˜ ê¸ˆì•¡ 0ì› ì²˜ë¦¬
- [x] DB ENUM `schedule_status`ì— `carried_over` ì¶”ê°€ SQL ìƒì„± (`ADD_CARRIED_OVER_STATUS.sql`)

### Phase 2: ì´ì›” â†” í¬ë ˆë”§ ì—°ë™ (í•µì‹¬) âœ… ì™„ë£Œ (2026-02-11)
- [x] ScheduleModalì—ì„œ ì´ì›” ì²˜ë¦¬ ì‹œ í¬ë ˆë”§ ìë™ ì ë¦½
- [x] Billing ëª¨ë‹¬ì—ì„œ ì´ì›” í¬ë ˆë”§ í‘œì‹œ ë° ì‚¬ìš©
- [x] ì´ì›” ì·¨ì†Œ ì‹œ í¬ë ˆë”§ ë³µì› ë¡œì§
- [x] Billing ìˆ˜ë‚© ëª¨ë‹¬ì—ì„œë„ ìƒíƒœ ë³€ê²½ ì‹œ í¬ë ˆë”§ ì—°ë™

### Phase 3: í™˜ë¶ˆ ë° ì´ë ¥ (í™•ì¥) âœ… ì™„ë£Œ (2026-02-11)
- [x] í™˜ë¶ˆ ì²˜ë¦¬ ê¸°ëŠ¥ ì¶”ê°€ (í™˜ë¶ˆ ë²„íŠ¼ + method='í™˜ë¶ˆ' ë ˆì½”ë“œ)
- [x] ìˆ˜ë‚© ì´ë ¥ ì¡°íšŒ UI (PaymentModal ë‚´ ì´ë ¥ íŒ¨ë„)
- [x] ìˆ˜ë‚© ìƒíƒœ ë±ƒì§€ (ì™„ë‚©/ë¯¸ìˆ˜/ë¯¸í™•ì •)
- [x] ê³¼ë‚© ê²½ê³  UI (AlertTriangle ì•„ì´ì½˜)
- [x] ì„¸ì…˜ë³„ ì´ì›”/ì·¨ì†Œ ì‹œê°ì  êµ¬ë¶„ (ì•„ì´ì½˜/ìƒ‰ìƒ/ë¼ë²¨)

### Phase 4: í†µê³„ ë° ë¦¬í¬íŠ¸ (ì„ íƒ)
- [ ] ì›”ë³„ ë§¤ì¶œ í†µê³„
- [ ] ë¯¸ìˆ˜ê¸ˆ ë¦¬í¬íŠ¸
- [x] ì—‘ì…€ ë‚´ë³´ë‚´ê¸° í•­ëª© í™•ì¥ (ì´ì›” ê¸ˆì•¡ ì¹¼ëŸ¼ ì¶”ê°€)

---

## 8. ê²°ë¡ 

í˜„ì¬ ìˆ˜ë‚©ê´€ë¦¬ ì‹œìŠ¤í…œì€ **ê¸°ë³¸ì ì¸ ìˆ˜ë‚©/ì·¨ì†Œ ê¸°ëŠ¥ì€ ì •ìƒ ì‘ë™**í•˜ì§€ë§Œ,
ì¼€ì–´í”Œê³¼ ë¹„êµí–ˆì„ ë•Œ **ì´ì›” â†” í¬ë ˆë”§ ì—°ë™**ì´ ê°€ì¥ í° ëˆ„ë½ ì‚¬í•­ì…ë‹ˆë‹¤.

### âœ… êµ¬í˜„ ì™„ë£Œ (2026-02-11)

| # | í•­ëª© | ìƒíƒœ | ìˆ˜ì • íŒŒì¼ |
|---|------|:---:|---------|
| 1 | ì´ì›” ì‹œ í¬ë ˆë”§ ìë™ ì ë¦½ | âœ… | `ScheduleModal.tsx`, `Billing.tsx` |
| 2 | Billingì—ì„œ ì´ì›” ìƒíƒœ ì¸ì‹ | âœ… | `Billing.tsx` |
| 3 | center_id í•„ìˆ˜ ì‚½ì… | âœ… | `Billing.tsx` |
| 4 | í™˜ë¶ˆ ê¸°ëŠ¥ | âœ… | `Billing.tsx` |
| 5 | ìˆ˜ë‚© ì´ë ¥ ì¡°íšŒ | âœ… | `Billing.tsx` |
| 6 | ì´ì›” í¬ë ˆë”§ ë³µì› (ì´ì›” ì·¨ì†Œ ì‹œ) | âœ… | `ScheduleModal.tsx`, `Billing.tsx` |
| 7 | DB ENUM ìˆ˜ì • SQL | âœ… | `ADD_CARRIED_OVER_STATUS.sql` |

### âš ï¸ ì‹¤í–‰ í•„ìš” SQL

```sql
-- Supabase SQL Editorì—ì„œ ì‹¤í–‰ í•„ìš” (1íšŒ)
ALTER TYPE schedule_status ADD VALUE IF NOT EXISTS 'carried_over';
```

ì‹¤í–‰ í›„ íƒ€ì… ì¬ìƒì„±:
```bash
npx supabase gen types typescript --project-id vspinpxqhulyfivikkij > src/types/database.types.ts
```

Phase 1 â†’ Phase 3ê¹Œì§€ êµ¬í˜„ ì™„ë£Œ. ì¼€ì–´í”Œ ìˆ˜ì¤€ì˜ ìˆ˜ë‚© ê¸°ëŠ¥ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
